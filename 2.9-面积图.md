2.9　面积图

### 2.9.1　基本面积图

使用 Plotly绘制面积图与绘制散点图和折线图相同，都使用 plotly graph_objs中的Scatter函数，不同之处在于面积图对于fill属性的设置，相当于在折线图的基础上对图形进行填充。如图2-28所示为基本面积图，展示了两个不同交易策略的净值曲线，为了方便，策略的每日收益率非真实数据，而是根据NumPy随机生成的数字。在图2-28中，使用mode属性隐藏了面积图的边界线，见文件2.9_AreaChart_1.py。

![img](https://cdn.nlark.com/yuque/0/2022/jpeg/21473765/1644303394572-6ca7b2eb-62f8-42aa-9617-18460e37746d.jpeg)

图2-28　基本面积图

本案例的代码如下。

![img](https://cdn.nlark.com/yuque/0/2022/jpeg/21473765/1644303394943-e4e1efa1-e69c-44ec-a969-7748bfcecc5d.jpeg)

![img](https://cdn.nlark.com/yuque/0/2022/jpeg/21473765/1644303395257-b59631f4-45d4-40ea-a4fa-cce9ee450e5e.jpeg)

![img](https://cdn.nlark.com/yuque/0/2022/jpeg/21473765/1644303395675-0dc88757-88c7-4786-9b05-3938547ee5d4.jpeg)

### 2.9.2　内部填充面积图

内部填充面积图仅填充两条曲线交叉所形成的面积部分，同样通过设置 fill属性来完成，只需在原面积图的基础上设置第一条曲线无填充效果，即fill = None，再设置第二条曲线的填充的效果为tonexty，即fill = 'tonexty'。如图2-29所示为内部填充面积图，该图是在图2-28的基础上，通过修改fill属性完成的。本案例见文件2.9_AreaChart_2.py。

![img](https://cdn.nlark.com/yuque/0/2022/jpeg/21473765/1644303396206-5c6f2e2a-a34f-4db9-98d7-44e702248cee.jpeg)

图2-29　内部填充面积图

本案例的代码如下。

![img](https://cdn.nlark.com/yuque/0/2022/jpeg/21473765/1644303396756-4b9526fb-1f03-4b17-95b6-245e054f2b87.jpeg)

![img](https://cdn.nlark.com/yuque/0/2022/jpeg/21473765/1644303397255-272e59b1-3e01-4d92-8ab4-abacfaf00943.jpeg)

### 2.9.3　堆积面积图

堆积面积图与层叠柱状图类似，都展示了数据累加的效果，不同之处在于对数据的设置，下面讲解堆积面积图的绘制，以及与层叠柱状图绘制的不同之处。为了更好地展示可视化效果，在层叠柱状图的基础上对数据进行了调整，见文件2.9_AreaChart_3.py。下面将堆积面积图中data1到data4中的数据单独列出，代码如下。

![img](https://cdn.nlark.com/yuque/0/2022/jpeg/21473765/1644303397781-3a9ec044-19a1-4a95-b782-b8f3fd7e4fa4.jpeg)

可以看出，data1中的y表示基金1到基金5中股票投资占总体投资的比例，与层叠柱状图相同；data2中的y表示基金1到基金5中股票投资与其他投资之和占总体投资的比例，而层叠柱状图data2中的y则表示基金1到基金5中其他投资占总体投资的比例。由此可见，从数据层面上讲，堆积面积图需要的是累加数据，而层叠柱状图只需要每部分的真实数据即可。

读者需要注意，在绘制层叠柱状图时需要设置stack模式，而绘制堆积面积图则不需要设置，这一点就是堆积面积图需要累加数据的原因，在本质上，堆积面积图的堆积效果是在同一个图形中绘制多个面积图来实现的。

堆积面积图的绘制效果如图2-30所示。

![img](https://cdn.nlark.com/yuque/0/2022/jpeg/21473765/1644303398258-0a5a4cb6-567c-4771-9aab-719b25c26503.jpeg)

图2-30　堆积面积图

本案例的代码如下。

![img](https://cdn.nlark.com/yuque/0/2022/jpeg/21473765/1644303398852-c1d53213-f63d-429f-8b9d-ecb6643c7d42.jpeg)

![img](https://cdn.nlark.com/yuque/0/2022/jpeg/21473765/1644303399299-e30b0d25-cb29-4d10-8a7a-c59fe715d23e.jpeg)

下面对代码中涉及的一些参数进行讲解。注意data中的line参数，这里的line用于设置折线的样式，只有在显示折线时才有设置的意义，即mode = 'lines'时。本案例中还设置了宽度（width）与颜色（color），Layout中的yaxis设置包含了y轴坐标的范围range是0～100，坐标间隔dtick是20，后缀符号ticksuffix是%。

至此，虽然已经可以对堆积面积图进行绘制，但是如果只知道原始数据，则需要计算出累积数据才能进行绘图，下面提供一个方法来完成累计数据的计算。

假设只知道4组原始数据yi_org，通过使用句内for循环来计算累计数据，代码如下。

![img](https://cdn.nlark.com/yuque/0/2022/jpeg/21473765/1644303399880-768a7832-b2b9-41b9-9a22-f13f16e63871.jpeg)

![img](https://cdn.nlark.com/yuque/0/2022/jpeg/21473765/1644303400333-b42ea51f-484c-4896-b3a6-9610fe2e4b1c.jpeg)
